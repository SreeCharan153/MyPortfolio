<?xml version="1.0" encoding="utf-8" ?>
<svg baseProfile="full" height="820" version="1.1" width="1200" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink"><defs /><rect fill="#0d1117" height="820" width="1200" x="0" y="0" /><text fill="#e6edf3" font-family="Inter, Arial, sans-serif" font-size="28px" text-anchor="middle" x="600.0" y="48">PillionPal – Detailed Backend Architecture</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="14px" text-anchor="middle" x="600.0" y="72">Client → FastAPI (Auth • WebSockets • FairSplit • Wallets) → PostgreSQL</text><g><rect fill="#161b22" fill-opacity="0.95" height="130" rx="14" ry="14" stroke="#30363d" stroke-width="2" width="320" x="80" y="110" /><text fill="#e6edf3" font-family="Inter, Arial, sans-serif" font-size="22px" x="98" y="150">Mobile App (Flutter)</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="14px" x="98" y="176">Rider &amp; Driver UI</text></g><g><rect fill="#161b22" fill-opacity="0.95" height="130" rx="14" ry="14" stroke="#30363d" stroke-width="2" width="300" x="440" y="110" /><text fill="#e6edf3" font-family="Inter, Arial, sans-serif" font-size="22px" x="458" y="150">MapBox API</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="14px" x="458" y="176">Routes • Distance • Maps</text></g><g><rect fill="#161b22" fill-opacity="0.95" height="360" rx="14" ry="14" stroke="#30363d" stroke-width="2" width="900" x="80" y="270" /><text fill="#e6edf3" font-family="Inter, Arial, sans-serif" font-size="22px" x="98" y="310">FastAPI Backend</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="14px" x="98" y="336">Auth • Ride • Wallet • FairSplit • WebSockets</text></g><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="16px" x="104" y="380">• Auth Service (OTP → JWT)</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="16px" x="104" y="414">• Ride Service (Book/Cancel/Lifecycle)</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="16px" x="104" y="448">• Wallet Service (Balance • Ledger)</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="16px" x="104" y="482">• FairSplit Engine (Mileage-based Fare)</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="16px" x="104" y="516">• WebSocket Hub (Live GPS)</text><g><rect fill="#2563eb" fill-opacity="0.85" height="26" rx="13" ry="13" width="117" x="700" y="370" /><text fill="#ffffff" font-family="Inter, Arial, sans-serif" font-size="12px" x="712" y="388">JWT + Refresh</text></g><g><rect fill="#2563eb" fill-opacity="0.85" height="26" rx="13" ry="13" width="117" x="700" y="404" /><text fill="#ffffff" font-family="Inter, Arial, sans-serif" font-size="12px" x="712" y="422">Rate Limiting</text></g><g><rect fill="#2563eb" fill-opacity="0.85" height="26" rx="13" ry="13" width="159" x="700" y="438" /><text fill="#ffffff" font-family="Inter, Arial, sans-serif" font-size="12px" x="712" y="456">Pydantic Validation</text></g><g><rect fill="#2563eb" fill-opacity="0.85" height="26" rx="13" ry="13" width="54" x="700" y="472" /><text fill="#ffffff" font-family="Inter, Arial, sans-serif" font-size="12px" x="712" y="490">CORS</text></g><g><rect fill="#2563eb" fill-opacity="0.85" height="26" rx="13" ry="13" width="138" x="700" y="506" /><text fill="#ffffff" font-family="Inter, Arial, sans-serif" font-size="12px" x="712" y="524">Background Tasks</text></g><g><rect fill="#161b22" fill-opacity="0.95" height="130" rx="14" ry="14" stroke="#30363d" stroke-width="2" width="420" x="80" y="650" /><text fill="#e6edf3" font-family="Inter, Arial, sans-serif" font-size="22px" x="98" y="690">PostgreSQL</text><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="14px" x="98" y="716">users • rides • wallets • history • audit_logs</text></g><text fill="#9fb3c8" font-family="Inter, Arial, sans-serif" font-size="13px" x="98" y="746">• Wallet updates &amp; ride payments are atomic (SQL TX)</text><line stroke="#8b949e" stroke-width="2" x1="240.0" x2="200" y1="240" y2="270" /><polygon fill="#8b949e" points="200,270 213.2,267.6 206.0,258.0" /><text fill="#c9d1d9" font-family="Inter, Arial, sans-serif" font-size="13px" text-anchor="middle" x="220.0" y="247.0">REST + JWT</text><line stroke="#8b949e" stroke-width="2" x1="280.0" x2="340" y1="240" y2="270" /><polygon fill="#8b949e" points="340,270 331.9501552810008,259.26687370800096 326.58359213500125,270.0" /><text fill="#c9d1d9" font-family="Inter, Arial, sans-serif" font-size="13px" text-anchor="middle" x="310.0" y="247.0">WebSockets (GPS)</text><line stroke="#8b949e" stroke-width="2" x1="590.0" x2="570.0" y1="240" y2="270" /><polygon fill="#8b949e" points="570.0,270 581.6487041207298,263.3435976452973 571.6641005886758,256.6871952905945" /><text fill="#c9d1d9" font-family="Inter, Arial, sans-serif" font-size="13px" text-anchor="middle" x="580.0" y="247.0">Route Distance API</text><line stroke="#8b949e" stroke-width="2" x1="400" x2="440" y1="150" y2="150" /><polygon fill="#8b949e" points="440,150 428.0,144.0 428.0,156.0" /><text fill="#c9d1d9" font-family="Inter, Arial, sans-serif" font-size="13px" text-anchor="middle" x="420.0" y="142.0">Map tiles &amp; geocoding</text><line stroke="#8b949e" stroke-width="2" x1="530.0" x2="220" y1="630" y2="650" /><polygon fill="#8b949e" points="220,650 232.36139737560927,655.2149645178351 231.5888100396337,643.2398608102137" /><text fill="#c9d1d9" font-family="Inter, Arial, sans-serif" font-size="13px" text-anchor="middle" x="375.0" y="632.0">SQL Queries</text><line stroke="#8b949e" stroke-width="2" x1="690.0" x2="340" y1="630" y2="650" /><polygon fill="#8b949e" points="340,650 352.32275475631883,655.3056305200816 351.63815726985666,643.325174506994" /><text fill="#c9d1d9" font-family="Inter, Arial, sans-serif" font-size="13px" text-anchor="middle" x="515.0" y="632.0">Ledger Writes</text></svg>